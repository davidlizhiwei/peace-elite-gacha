<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å’Œå¹³ç²¾è‹± - çš®è‚¤ç›²ç›’</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    .game-container {
      max-width: 500px;
      width: 100%;
      background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
      border-radius: 25px;
      padding: 30px 20px;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5),
                  0 0 100px rgba(255, 215, 0, 0.2);
      border: 3px solid rgba(255, 215, 0, 0.3);
      text-align: center;
    }

    /* æ ‡é¢˜åŒºåŸŸ */
    .header {
      margin-bottom: 25px;
    }

    .title {
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(135deg, #ffd700 0%, #ffec8b 50%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
      margin-bottom: 5px;
    }

    .subtitle {
      color: #9ca3af;
      font-size: 14px;
    }

    /* è´§å¸æ˜¾ç¤º */
    .currency-bar {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
    }

    .currency {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 20px;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .currency-icon {
      font-size: 20px;
    }

    .currency-value {
      color: #ffd700;
      font-weight: bold;
      font-size: 18px;
    }

    /* ç›²ç›’åŒºåŸŸ */
    .blind-box-container {
      position: relative;
      margin-bottom: 30px;
    }

    .blind-box {
      width: 200px;
      height: 200px;
      margin: 0 auto;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      border-radius: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 100px;
      cursor: pointer;
      box-shadow: 0 10px 40px rgba(139, 92, 246, 0.5),
                  inset 0 0 60px rgba(255, 255, 255, 0.1);
      border: 4px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .blind-box::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 70%
      );
      animation: shine 3s ease-in-out infinite;
    }

    @keyframes shine {
      0%, 100% { transform: translateX(-100%) rotate(45deg); }
      50% { transform: translateX(100%) rotate(45deg); }
    }

    .blind-box:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 50px rgba(139, 92, 246, 0.7);
    }

    .blind-box.shaking {
      animation: shake 0.5s ease-in-out infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0) rotate(0); }
      25% { transform: translateX(-10px) rotate(-5deg); }
      75% { transform: translateX(10px) rotate(5deg); }
    }

    .blind-box.opening {
      animation: open 0.5s ease-out forwards;
    }

    @keyframes open {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(0); opacity: 0; }
    }

    /* ç¨€æœ‰åº¦æ ‡ç­¾ */
    .rarity-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }

    .rarity-common { background: linear-gradient(135deg, #6b7280, #4b5563); }
    .rarity-rare { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .rarity-epic { background: linear-gradient(135deg, #a855f7, #7c3aed); }
    .rarity-legendary { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .rarity-mythic { background: linear-gradient(135deg, #ef4444, #dc2626); }

    /* æŠ½å¡æŒ‰é’® */
    .pull-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }

    .pull-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .pull-btn-single {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    }

    .pull-btn-ten {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
    }

    .pull-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
    }

    .pull-btn:active {
      transform: translateY(-1px);
    }

    .pull-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pull-cost {
      font-size: 12px;
      opacity: 0.9;
    }

    /* ç»“æœå±•ç¤ºåŒºåŸŸ */
    .result-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .result-modal.show {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .result-content {
      background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
      border-radius: 25px;
      padding: 40px 30px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      border: 3px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 100px rgba(255, 215, 0, 0.3);
    }

    .result-title {
      font-size: 24px;
      color: #ffd700;
      margin-bottom: 20px;
    }

    .result-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .result-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 15px 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      animation: itemAppear 0.5s ease-out backwards;
    }

    @keyframes itemAppear {
      from {
        opacity: 0;
        transform: scale(0.5) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .result-item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
    }

    .result-item.name {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
    }

    .result-item.rarity-common { border-color: #6b7280; }
    .result-item.rarity-rare { border-color: #3b82f6; }
    .result-item.rarity-epic { border-color: #a855f7; }
    .result-item.rarity-legendary { border-color: #f59e0b; }
    .result-item.rarity-mythic { border-color: #ef4444; }

    .close-btn {
      padding: 12px 40px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    }

    /* æ”¶è—åŒºåŸŸ */
    .collection-section {
      margin-top: 25px;
      padding-top: 25px;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
    }

    .collection-title {
      color: #9ca3af;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .collection-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .collection-item {
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }

    .collection-item.new {
      border-color: #ffd700;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .collection-item.new::after {
      content: 'NEW';
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ffd700;
      color: #000;
      font-size: 8px;
      padding: 2px 4px;
      border-radius: 5px;
      font-weight: bold;
    }

    /* ç‰¹æ•ˆ */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    .particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: fall 2s ease-out forwards;
    }

    @keyframes fall {
      0% {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
      }
    }

    /* æ»šåŠ¨æç¤º */
    .scroll-hint {
      color: #6b7280;
      font-size: 12px;
      margin-top: 10px;
    }

    /* å……å€¼å¼¹çª—æ ·å¼ */
    .recharge-packages {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .recharge-package {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
      border: 2px solid rgba(99, 102, 241, 0.3);
      border-radius: 15px;
      padding: 20px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .recharge-package:hover {
      transform: translateY(-3px);
      border-color: rgba(99, 102, 241, 0.6);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
    }

    .recharge-package.popular {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(245, 158, 11, 0.2));
    }

    .popular-tag {
      position: absolute;
      top: -8px;
      right: 50%;
      transform: translateX(50%);
      background: linear-gradient(135deg, #ffd700, #ffec8b);
      color: #000;
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 10px;
      font-weight: bold;
      white-space: nowrap;
    }

    .package-icon {
      font-size: 36px;
    }

    .package-amount {
      color: #ffd700;
      font-weight: bold;
      font-size: 16px;
    }

    .package-price {
      color: #3b82f6;
      font-weight: bold;
      font-size: 18px;
      background: rgba(59, 130, 246, 0.2);
      padding: 5px 15px;
      border-radius: 20px;
    }

    .recharge-note {
      color: #6b7280;
      font-size: 12px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <div class="title">ğŸ çš®è‚¤ç›²ç›’</div>
      <div class="subtitle">å’Œå¹³ç²¾è‹± Â· å¹¸è¿æŠ½å¥–</div>
    </div>

    <!-- è´§å¸æ  -->
    <div class="currency-bar">
      <div class="currency">
        <span class="currency-icon">ğŸ’</span>
        <span class="currency-value" id="gems">1000</span>
      </div>
      <div class="currency">
        <span class="currency-icon">ğŸ«</span>
        <span class="currency-value" id="tickets">5</span>
      </div>
      <div class="currency" style="cursor: pointer;" onclick="openRechargeModal()">
        <span class="currency-icon">â•</span>
        <span class="currency-value">å……å€¼</span>
      </div>
    </div>

    <!-- ç›²ç›’ -->
    <div class="blind-box-container">
      <div class="blind-box" id="blind-box">
        ğŸ
      </div>
    </div>

    <!-- æŠ½å¡æŒ‰é’® -->
    <div class="pull-buttons">
      <button class="pull-btn pull-btn-single" id="single-pull" onclick="pull(1)">
        <span>å•æ¬¡æŠ½å–</span>
        <span class="pull-cost">ğŸ’ 100 æˆ– ğŸ« 1</span>
      </button>
      <button class="pull-btn pull-btn-ten" id="ten-pull" onclick="pull(10)">
        <span>åè¿æŠ½</span>
        <span class="pull-cost">ğŸ’ 900 æˆ– ğŸ« 8</span>
      </button>
    </div>

    <!-- æ”¶è—åŒºåŸŸ -->
    <div class="collection-section">
      <div class="collection-title">æˆ‘çš„æ”¶è— (<span id="collection-count">0</span>/<span id="total-count">0</span>)</div>
      <div class="collection-grid" id="collection-grid"></div>
    </div>

    <div class="scroll-hint">â¬†ï¸ å‘ä¸Šæ»šåŠ¨æŸ¥çœ‹æ›´å¤šæ”¶è—</div>
  </div>

  <!-- ç»“æœå¼¹çª— -->
  <div class="result-modal" id="result-modal">
    <div class="result-content">
      <div class="result-title" id="result-title">ğŸ‰ æ­å–œè·å¾—</div>
      <div class="result-items" id="result-items"></div>
      <button class="close-btn" onclick="closeModal()">æ”¶ä¸‹å¥–åŠ±</button>
    </div>
  </div>

  <!-- å……å€¼å¼¹çª— -->
  <div class="result-modal" id="recharge-modal">
    <div class="result-content">
      <div class="result-title">ğŸ’ å……å€¼ä¸­å¿ƒ</div>
      <div class="recharge-packages" id="recharge-packages">
        <div class="recharge-package" onclick="recharge('gems', 60, 6)">
          <div class="package-icon">ğŸ’</div>
          <div class="package-amount">60 é’»çŸ³</div>
          <div class="package-price">Â¥6</div>
        </div>
        <div class="recharge-package" onclick="recharge('gems', 300, 30)">
          <div class="package-icon">ğŸ’</div>
          <div class="package-amount">300 é’»çŸ³</div>
          <div class="package-price">Â¥30</div>
        </div>
        <div class="recharge-package popular" onclick="recharge('gems', 600, 60)">
          <div class="popular-tag">çƒ­é—¨</div>
          <div class="package-icon">ğŸ’</div>
          <div class="package-amount">600 é’»çŸ³</div>
          <div class="package-price">Â¥60</div>
        </div>
        <div class="recharge-package" onclick="recharge('gems', 1500, 150)">
          <div class="package-icon">ğŸ’</div>
          <div class="package-amount">1500 é’»çŸ³</div>
          <div class="package-price">Â¥150</div>
        </div>
        <div class="recharge-package" onclick="recharge('tickets', 10, 10)">
          <div class="package-icon">ğŸ«</div>
          <div class="package-amount">10 æŠ½å¥–åˆ¸</div>
          <div class="package-price">Â¥10</div>
        </div>
        <div class="recharge-package" onclick="recharge('tickets', 50, 45)">
          <div class="package-icon">ğŸ«</div>
          <div class="package-amount">50 æŠ½å¥–åˆ¸</div>
          <div class="package-price">Â¥45</div>
        </div>
      </div>
      <div class="recharge-note">* æ¨¡æ‹Ÿå……å€¼ï¼Œä¸ä¼šå®é™…æ‰£æ¬¾</div>
      <button class="close-btn" onclick="closeRechargeModal()">å…³é—­</button>
    </div>
  </div>

  <!-- ç²’å­ç‰¹æ•ˆå®¹å™¨ -->
  <div class="particles" id="particles"></div>

  <script>
    // çš®è‚¤æ•°æ®åº“ï¼ˆä½¿ç”¨å’Œå¹³ç²¾è‹±ä¸»é¢˜å›¾ç‰‡ï¼‰
    const skins = [
      // æ™®é€š (50%)
      { name: 'è¿·å½© T æ¤', image: 'https://picsum.photos/seed/gacha-camo-tee/200/200', rarity: 'common', weight: 50 },
      { name: 'è¿åŠ¨çŸ­è£¤', image: 'https://picsum.photos/seed/gacha-sports-shorts/200/200', rarity: 'common', weight: 50 },
      { name: 'ä¼‘é—²é‹', image: 'https://picsum.photos/seed/gacha-casual-shoes/200/200', rarity: 'common', weight: 50 },
      { name: 'æ£’çƒå¸½', image: 'https://picsum.photos/seed/gacha-baseball-cap/200/200', rarity: 'common', weight: 50 },
      { name: 'å¤ªé˜³é•œ', image: 'https://picsum.photos/seed/gacha-sunglasses/200/200', rarity: 'common', weight: 50 },

      // ç¨€æœ‰ (30%)
      { name: 'æˆ˜æœ¯èƒŒå¿ƒ', image: 'https://picsum.photos/seed/gacha-tactical-vest/200/200', rarity: 'rare', weight: 30 },
      { name: 'ä½œæˆ˜é´', image: 'https://picsum.photos/seed/gacha-combat-boots/200/200', rarity: 'rare', weight: 30 },
      { name: 'ç‰¹ç§å¤´ç›”', image: 'https://picsum.photos/seed/gacha-helmet/200/200', rarity: 'rare', weight: 30 },
      { name: 'æˆ˜æœ¯æ‰‹å¥—', image: 'https://picsum.photos/seed/gacha-gloves/200/200', rarity: 'rare', weight: 30 },

      // å²è¯— (15%)
      { name: 'é»„é‡‘é“ ç”²', image: 'https://picsum.photos/seed/gacha-gold-armor/200/200', rarity: 'epic', weight: 15 },
      { name: 'å¹»å½±æŠ«é£', image: 'https://picsum.photos/seed/gacha-phantom-cape/200/200', rarity: 'epic', weight: 15 },
      { name: 'æ¿€å…‰æˆ˜ç”²', image: 'https://picsum.photos/seed/gacha-laser-suit/200/200', rarity: 'epic', weight: 15 },

      // ä¼ è¯´ (4.5%)
      { name: 'é¾™ç‹æˆ˜è¢', image: 'https://picsum.photos/seed/gacha-dragon-robe/200/200', rarity: 'legendary', weight: 4.5 },
      { name: 'å‡¤å‡°ç¾½ç¿¼', image: 'https://picsum.photos/seed/gacha-phoenix-wings/200/200', rarity: 'legendary', weight: 4.5 },

      // ç¥è¯ (0.5%)
      { name: 'æ˜Ÿæ²³æˆ˜ç”²', image: 'https://picsum.photos/seed/gacha-galaxy-armor/200/200', rarity: 'mythic', weight: 0.5 },
      { name: 'è‡³å°Šç‹è€…', image: 'https://picsum.photos/seed/gacha-supreme-king/200/200', rarity: 'mythic', weight: 0.5 },
    ];

    // æ¸¸æˆçŠ¶æ€
    let gems = 1000;
    let tickets = 5;
    let collection = [];
    let isNewPull = false;

    // ç¨€æœ‰åº¦é¢œè‰²
    const rarityColors = {
      common: '#6b7280',
      rare: '#3b82f6',
      epic: '#a855f7',
      legendary: '#f59e0b',
      mythic: '#ef4444'
    };

    const rarityNames = {
      common: 'æ™®é€š',
      rare: 'ç¨€æœ‰',
      epic: 'å²è¯—',
      legendary: 'ä¼ è¯´',
      mythic: 'ç¥è¯'
    };

    // åˆå§‹åŒ–
    function init() {
      updateUI();
      renderCollection();
      document.getElementById('total-count').textContent = skins.length;
    }

    // æ›´æ–° UI
    function updateUI() {
      document.getElementById('gems').textContent = gems;
      document.getElementById('tickets').textContent = tickets;
      document.getElementById('collection-count').textContent = collection.length;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.getElementById('single-pull').disabled = gems < 100 && tickets < 1;
      document.getElementById('ten-pull').disabled = gems < 900 && tickets < 8;
    }

    // æŠ½å–é€»è¾‘
    function pullSkin() {
      const totalWeight = skins.reduce((sum, skin) => sum + skin.weight, 0);
      let random = Math.random() * totalWeight;

      for (const skin of skins) {
        random -= skin.weight;
        if (random <= 0) {
          return skin;
        }
      }
      return skins[0];
    }

    // æŠ½å¡
    function pull(count) {
      const gemCost = count === 1 ? 100 : 900;
      const ticketCost = count === 1 ? 1 : 8;

      // æ£€æŸ¥èµ„æº
      if (gems < gemCost && tickets < ticketCost) {
        alert('èµ„æºä¸è¶³ï¼éœ€è¦ ğŸ’' + gemCost + ' æˆ– ğŸ«' + ticketCost);
        return;
      }

      // ä¼˜å…ˆä½¿ç”¨æŠ½å¥–åˆ¸
      if (tickets >= ticketCost) {
        tickets -= ticketCost;
      } else {
        gems -= gemCost;
      }

      updateUI();

      // åŠ¨ç”»
      const blindBox = document.getElementById('blind-box');
      blindBox.classList.add('shaking');

      setTimeout(() => {
        blindBox.classList.remove('shaking');
        blindBox.classList.add('opening');

        setTimeout(() => {
          // ç”Ÿæˆç»“æœ
          const results = [];
          for (let i = 0; i < count; i++) {
            results.push(pullSkin());
          }

          // æ˜¾ç¤ºç»“æœ
          showResults(results);

          // é‡ç½®ç›²ç›’
          setTimeout(() => {
            blindBox.classList.remove('opening');
          }, 300);
        }, 500);
      }, 1000);
    }

    // æ˜¾ç¤ºç»“æœ
    function showResults(results) {
      const modal = document.getElementById('result-modal');
      const itemsContainer = document.getElementById('result-items');
      const titleEl = document.getElementById('result-title');

      // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰©å“
      const newItems = results.filter(r => !collection.some(c => c.name === r.name));
      const hasNew = newItems.length > 0;

      // æ·»åŠ åˆ°æ”¶è—
      results.forEach(r => {
        if (!collection.some(c => c.name === r.name)) {
          collection.push(r);
        }
      });

      // è®¾ç½®æ ‡é¢˜
      if (hasNew) {
        titleEl.textContent = 'ğŸ‰ æ­å–œè·å¾—æ–°çš®è‚¤ï¼';
      } else {
        titleEl.textContent = 'âœ¨ è·å¾—ç‰©å“';
      }

      // æ¸²æŸ“ç»“æœ
      itemsContainer.innerHTML = '';
      results.forEach((result, index) => {
        const itemEl = document.createElement('div');
        itemEl.className = `result-item rarity-${result.rarity}`;
        itemEl.style.animationDelay = `${index * 0.1}s`;
        itemEl.innerHTML = `
          <img class="result-item-image" src="${result.image}" alt="${result.name}" onload="this.style.opacity=1" onerror="this.src='https://picsum.photos/seed/gacha-default/200/200'">
          <div class="name">${result.name}</div>
        `;
        itemsContainer.appendChild(itemEl);
      });

      // æ›´æ–°æ”¶è—
      renderCollection();
      updateUI();

      // æ˜¾ç¤ºå¼¹çª—
      modal.classList.add('show');

      // å¦‚æœæœ‰ä¼ è¯´æˆ–ç¥è¯ï¼Œæ”¾ç‰¹æ•ˆ
      const hasHighRarity = results.some(r => r.rarity === 'legendary' || r.rarity === 'mythic');
      if (hasHighRarity) {
        createParticles();
      }
    }

    // å…³é—­å¼¹çª—
    function closeModal() {
      document.getElementById('result-modal').classList.remove('show');
    }

    // æ‰“å¼€å……å€¼å¼¹çª—
    function openRechargeModal() {
      document.getElementById('recharge-modal').classList.add('show');
    }

    // å…³é—­å……å€¼å¼¹çª—
    function closeRechargeModal() {
      document.getElementById('recharge-modal').classList.remove('show');
    }

    // å……å€¼åŠŸèƒ½
    function recharge(type, amount, price) {
      if (confirm(`ç¡®è®¤å……å€¼ ${amount} ${type === 'gems' ? 'ğŸ’é’»çŸ³' : 'ğŸ«æŠ½å¥–åˆ¸'}ï¼Œä»·æ ¼ Â¥${price}ï¼Ÿ\n\n* æ¨¡æ‹Ÿå……å€¼ï¼Œä¸ä¼šå®é™…æ‰£æ¬¾`)) {
        if (type === 'gems') {
          gems += amount;
        } else {
          tickets += amount;
        }
        updateUI();
        closeRechargeModal();
        alert(`å……å€¼æˆåŠŸï¼è·å¾— ${amount} ${type === 'gems' ? 'é’»çŸ³' : 'æŠ½å¥–åˆ¸'}`);
      }
    }

    // æ¸²æŸ“æ”¶è—
    function renderCollection() {
      const grid = document.getElementById('collection-grid');
      grid.innerHTML = '';

      // æŒ‰ç¨€æœ‰åº¦æ’åº
      const rarityOrder = { mythic: 0, legendary: 1, epic: 2, rare: 3, common: 4 };
      const sorted = [...collection].sort((a, b) => rarityOrder[a.rarity] - rarityOrder[b.rarity]);

      sorted.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'collection-item';
        itemEl.style.borderColor = rarityColors[item.rarity];
        itemEl.innerHTML = `<img src="${item.image}" alt="${item.name}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" onerror="this.src='https://picsum.photos/seed/gacha-default/200/200'">`;
        itemEl.title = `${item.name} - ${rarityNames[item.rarity]}`;
        grid.appendChild(itemEl);
      });
    }

    // ç²’å­ç‰¹æ•ˆ
    function createParticles() {
      const container = document.getElementById('particles');
      const colors = ['#ffd700', '#f59e0b', '#ef4444', '#a855f7', '#3b82f6'];

      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.background = colors[Math.floor(Math.random() * colors.length)];
          particle.style.width = (Math.random() * 10 + 5) + 'px';
          particle.style.height = particle.style.width;

          container.appendChild(particle);

          setTimeout(() => particle.remove(), 2000);
        }, i * 30);
      }
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    init();
  </script>
</body>
</html>
